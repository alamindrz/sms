<div class="space-y-1">
  {% for item in nav_items %}
    {% if item.children %}
      <!-- Parent item with dropdown -->
      <div class="nav-item">
        <button onclick="toggleDropdown(this)" 
                class="w-full flex items-center justify-between px-3 py-2.5 rounded-lg transition-all duration-200 hover:bg-gray-100 dark:hover:bg-gray-700 group">
          <div class="flex items-center">
            <i class="{{ item.icon }} text-gray-500 dark:text-gray-400 group-hover:text-indigo-500 text-sm mr-3 w-5 text-center"></i>
            <span class="text-sm font-medium text-gray-700 dark:text-gray-300 group-hover:text-indigo-600 dark:group-hover:text-indigo-400">
              {{ item.title }}
            </span>
          </div>
          <i class="dropdown-icon fas fa-chevron-right text-xs text-gray-400 transition-transform duration-200"></i>
        </button>
        
        <!-- Children -->
        <div class="dropdown-content ml-4 mt-1 space-y-1 border-l border-gray-200 dark:border-gray-700 pl-3 hidden">
          {% for child in item.children %}
            <a href="{% if child.url != '#' %}{% url child.url %}{% else %}#{% endif %}" 
               class="flex items-center px-3 py-2 rounded-lg text-sm transition-all duration-200 
                      {% if request.resolver_match.url_name == child.url or request.resolver_match.url_name in child.url %} 
                        bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 
                      {% else %}
                        text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-gray-800 dark:hover:text-gray-300
                      {% endif %}"
               onclick="closeSidebarOnMobile()">
              <i class="{{ child.icon|default:'far fa-circle' }} text-xs mr-3 w-4 text-center"></i>
              {{ child.title }}
            </a>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <!-- Single item -->
      <a href="{% url item.url %}" 
         class="nav-item flex items-center px-3 py-2.5 rounded-lg transition-all duration-200 group 
                {% if request.resolver_match.url_name == item.url or request.resolver_match.url_name in item.url %} 
                  bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 
                {% else %}
                  hover:bg-gray-100 dark:hover:bg-gray-700
                {% endif %}"
         onclick="closeSidebarOnMobile()">
        <div class="relative">
          <i class="{{ item.icon }} text-gray-500 dark:text-gray-400 group-hover:text-indigo-500 text-sm mr-3 w-5 text-center"></i>
        </div>
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300 group-hover:text-indigo-600 dark:group-hover:text-indigo-400">
          {{ item.title }}
        </span>
      </a>
    {% endif %}
  {% endfor %}
  
  <!-- Always visible links -->
  <div class="pt-4 mt-4 border-t border-gray-200 dark:border-gray-700">
    <a href="{% url 'admissions:application_create' %}" 
       class="flex items-center px-3 py-2.5 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:opacity-90 transition-opacity"
       onclick="closeSidebarOnMobile()">
      <i class="fas fa-file-alt text-sm mr-3"></i>
      <span class="text-sm font-medium">Apply for Admission</span>
      <i class="fas fa-arrow-right ml-auto text-xs"></i>
    </a>
  </div>
</div>

<script>
  function toggleDropdown(button) {
    const dropdownContent = button.nextElementSibling;
    const dropdownIcon = button.querySelector('.dropdown-icon');
    
    dropdownContent.classList.toggle('hidden');
    dropdownIcon.classList.toggle('rotate-90');
  }
  
  // Close dropdowns when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.nav-item button')) {
      document.querySelectorAll('.dropdown-content').forEach(content => {
        content.classList.add('hidden');
      });
      document.querySelectorAll('.dropdown-icon').forEach(icon => {
        icon.classList.remove('rotate-90');
      });
    }
  });
</script>